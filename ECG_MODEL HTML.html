<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>0f998ea2b379468789d6e1243c555570</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="ca6d7b21" class="cell code" id="ca6d7b21"
data-outputId="6cf88f78-62f0-4e0a-d0bd-dc8bad3f2a33">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Convolution2D</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> MaxPooling2D</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Flatten</span></code></pre></div>
<div class="output stream stdout">
<pre><code>WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

</code></pre>
</div>
</div>
<div id="3eb14c79" class="cell code" id="3eb14c79">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span></code></pre></div>
</div>
<div id="24c84707" class="cell code" id="24c84707">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(rescale <span class="op">=</span> <span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>,shear_range <span class="op">=</span> <span class="fl">0.2</span>,zoom_range <span class="op">=</span> <span class="fl">0.2</span>,horizontal_flip <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale <span class="op">=</span> <span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span></code></pre></div>
</div>
<div id="ae2c6d4c" class="cell code" id="ae2c6d4c"
data-outputId="e6a52b88-3316-49c9-88fe-c7313beb6417">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> train_datagen.flow_from_directory(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\train&quot;</span>,target_size <span class="op">=</span> (<span class="dv">64</span>,<span class="dv">64</span>),batch_size <span class="op">=</span> <span class="dv">32</span>,class_mode <span class="op">=</span> <span class="st">&quot;categorical&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> test_datagen.flow_from_directory(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\test&quot;</span>,target_size <span class="op">=</span> (<span class="dv">64</span>,<span class="dv">64</span>),batch_size <span class="op">=</span> <span class="dv">32</span>,class_mode <span class="op">=</span> <span class="st">&quot;categorical&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Found 15341 images belonging to 6 classes.
Found 6825 images belonging to 6 classes.
</code></pre>
</div>
</div>
<div id="6383fa2e" class="cell code" id="6383fa2e"
data-outputId="8f2cc496-eb01-4fd1-f6e0-4c9bfb3c70fa">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x_train.class_indices</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<pre><code>{&#39;Left Bundle Branch Block&#39;: 0,
 &#39;Normal&#39;: 1,
 &#39;Premature Atrial Contraction&#39;: 2,
 &#39;Premature Ventricular Contractions&#39;: 3,
 &#39;Right Bundle Branch Block&#39;: 4,
 &#39;Ventricular Fibrillation&#39;: 5}</code></pre>
</div>
</div>
<div id="81b3950b" class="cell code" id="81b3950b"
data-outputId="5b83056f-6622-4cda-de37-cf9c8426cccb">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\backend.py:873: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.

</code></pre>
</div>
</div>
<div id="e0ad09f3" class="cell code" id="e0ad09f3">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model.add(Convolution2D(<span class="dv">32</span>,(<span class="dv">3</span>,<span class="dv">3</span>),input_shape <span class="op">=</span> (<span class="dv">64</span>,<span class="dv">64</span>,<span class="dv">3</span>),activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span>))</span></code></pre></div>
</div>
<div id="3f935edc" class="cell code" id="3f935edc"
data-outputId="91f9cb8f-4510-4cf2-de09-f7c10f611118">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model.add(MaxPooling2D(pool_size <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">2</span>)))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\layers\pooling\max_pooling2d.py:161: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.

</code></pre>
</div>
</div>
<div id="9c26b101" class="cell code" id="9c26b101">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model.add(Convolution2D(<span class="dv">32</span>,(<span class="dv">3</span>,<span class="dv">3</span>),activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span></code></pre></div>
</div>
<div id="0b575156" class="cell code" id="0b575156">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>)))</span></code></pre></div>
</div>
<div id="f1c134f3" class="cell code" id="f1c134f3">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>model.add(Flatten()) <span class="co"># input of ANN</span></span></code></pre></div>
</div>
<div id="53edde4d" class="cell code" id="53edde4d">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units <span class="op">=</span> <span class="dv">128</span>,kernel_initializer <span class="op">=</span> <span class="st">&quot;random_uniform&quot;</span>,activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span>))</span></code></pre></div>
</div>
<div id="b628bf1f" class="cell code" id="b628bf1f">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units <span class="op">=</span> <span class="dv">128</span>,kernel_initializer <span class="op">=</span> <span class="st">&quot;random_uniform&quot;</span>,activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span>))</span></code></pre></div>
</div>
<div id="7788f2b1" class="cell code" id="7788f2b1">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units <span class="op">=</span> <span class="dv">128</span>,kernel_initializer <span class="op">=</span> <span class="st">&quot;random_uniform&quot;</span>,activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span>))</span></code></pre></div>
</div>
<div id="caca662c" class="cell code" id="caca662c">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units <span class="op">=</span> <span class="dv">6</span>,kernel_initializer <span class="op">=</span> <span class="st">&quot;random_uniform&quot;</span>,activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>))</span></code></pre></div>
</div>
<div id="ba713961" class="cell code" id="ba713961"
data-outputId="73a1a624-6b2c-403e-f8c2-d7e56a2f1612">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 conv2d (Conv2D)             (None, 62, 62, 32)        896       
                                                                 
 max_pooling2d (MaxPooling2  (None, 31, 31, 32)        0         
 D)                                                              
                                                                 
 conv2d_1 (Conv2D)           (None, 29, 29, 32)        9248      
                                                                 
 max_pooling2d_1 (MaxPoolin  (None, 14, 14, 32)        0         
 g2D)                                                            
                                                                 
 flatten (Flatten)           (None, 6272)              0         
                                                                 
 dense (Dense)               (None, 128)               802944    
                                                                 
 dense_1 (Dense)             (None, 128)               16512     
                                                                 
 dense_2 (Dense)             (None, 128)               16512     
                                                                 
 dense_3 (Dense)             (None, 6)                 774       
                                                                 
=================================================================
Total params: 846886 (3.23 MB)
Trainable params: 846886 (3.23 MB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
</code></pre>
</div>
</div>
<div id="c57a0dbd" class="cell code" id="c57a0dbd"
data-outputId="ed3ec702-2377-41d7-f5c2-ee7dbd899955">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>,metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\optimizers\__init__.py:309: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

</code></pre>
</div>
</div>
<div id="a726f5ef" class="cell code" id="a726f5ef"
data-outputId="78192fab-aa80-4098-e198-3455332f648c">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model.fit_generator(generator<span class="op">=</span>x_train,steps_per_epoch <span class="op">=</span> <span class="bu">len</span>(x_train), epochs<span class="op">=</span><span class="dv">10</span>, validation_data<span class="op">=</span>x_test,validation_steps <span class="op">=</span> <span class="bu">len</span>(x_test))</span></code></pre></div>
<div class="output stream stderr">
<pre><code>C:\Users\HP\AppData\Local\Temp\ipykernel_19420\53529210.py:1: UserWarning: `Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators.
  model.fit_generator(generator=x_train,steps_per_epoch = len(x_train), epochs=10, validation_data=x_test,validation_steps = len(x_test))
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 1/10
WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\utils\tf_utils.py:492: The name tf.ragged.RaggedTensorValue is deprecated. Please use tf.compat.v1.ragged.RaggedTensorValue instead.

WARNING:tensorflow:From C:\Users\HP\anaconda3\Lib\site-packages\keras\src\engine\base_layer_utils.py:384: The name tf.executing_eagerly_outside_functions is deprecated. Please use tf.compat.v1.executing_eagerly_outside_functions instead.

480/480 [==============================] - 300s 619ms/step - loss: 1.2513 - accuracy: 0.5495 - val_loss: 1.5194 - val_accuracy: 0.4992
Epoch 2/10
480/480 [==============================] - 72s 150ms/step - loss: 0.6551 - accuracy: 0.7687 - val_loss: 1.0613 - val_accuracy: 0.6847
Epoch 3/10
480/480 [==============================] - 71s 148ms/step - loss: 0.3302 - accuracy: 0.8904 - val_loss: 0.7250 - val_accuracy: 0.8251
Epoch 4/10
480/480 [==============================] - 71s 149ms/step - loss: 0.1886 - accuracy: 0.9417 - val_loss: 0.5118 - val_accuracy: 0.8642
Epoch 5/10
480/480 [==============================] - 69s 143ms/step - loss: 0.1468 - accuracy: 0.9535 - val_loss: 0.5430 - val_accuracy: 0.8520
Epoch 6/10
480/480 [==============================] - 73s 152ms/step - loss: 0.1212 - accuracy: 0.9623 - val_loss: 0.4257 - val_accuracy: 0.8731
Epoch 7/10
480/480 [==============================] - 184s 384ms/step - loss: 0.1038 - accuracy: 0.9668 - val_loss: 0.5467 - val_accuracy: 0.8605
Epoch 8/10
480/480 [==============================] - 74s 153ms/step - loss: 0.0902 - accuracy: 0.9714 - val_loss: 0.5037 - val_accuracy: 0.8665
Epoch 9/10
480/480 [==============================] - 71s 149ms/step - loss: 0.0819 - accuracy: 0.9751 - val_loss: 0.6949 - val_accuracy: 0.8593
Epoch 10/10
480/480 [==============================] - 72s 149ms/step - loss: 0.0687 - accuracy: 0.9779 - val_loss: 0.8362 - val_accuracy: 0.8615
</code></pre>
</div>
<div class="output execute_result" data-execution_count="19">
<pre><code>&lt;keras.src.callbacks.History at 0x1c20b7eae90&gt;</code></pre>
</div>
</div>
<div id="2ee66eef" class="cell code" id="2ee66eef"
data-outputId="b74241f0-a45f-458f-8723-b12cb49d54e0">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model.save(<span class="st">&#39;Dheeraj_ECG_1.h5&#39;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>C:\Users\HP\anaconda3\Lib\site-packages\keras\src\engine\training.py:3103: UserWarning: You are saving your model as an HDF5 file via `model.save()`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)`.
  saving_api.save_model(
</code></pre>
</div>
</div>
<div id="1wrgbginWuDx" class="cell code" data-execution_count="7"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="1wrgbginWuDx" data-outputId="39609ca3-2057-4809-c191-3b5556aff505">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> model.predict_generator(test_generator)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_generator.classes</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Confusion Matrix:&quot;</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/bee43a73806d881685e205c8fb3d78b9d56fcfcf.png" /></p>
</div>
</div>
<div id="65bcdd4b" class="cell code" id="65bcdd4b">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> load_model</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing <span class="im">import</span> image</span></code></pre></div>
</div>
<div id="49b920c1" class="cell code" id="49b920c1">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>load_model(<span class="st">&#39;Dheeraj_ECG_1.h5&#39;</span>)</span></code></pre></div>
</div>
<div id="0ab7a1d9" class="cell code" id="0ab7a1d9">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>img<span class="op">=</span>image.load_img(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\JupyterNotebook Training\testing.png&quot;</span>,target_size<span class="op">=</span>(<span class="dv">64</span>,<span class="dv">64</span>))</span></code></pre></div>
</div>
<div id="f83c344d" class="cell code" id="f83c344d">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>image.img_to_array(img)</span></code></pre></div>
</div>
<div id="50494b25" class="cell code" id="50494b25">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
</div>
<div id="b562d2b2" class="cell code" id="b562d2b2">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.expand_dims(x,axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="9b505f71" class="cell code" id="9b505f71"
data-outputId="fc5febd3-3e6e-43dd-92d8-053d78cf1544">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(x)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>1/1 [==============================] - 0s 283ms/step
</code></pre>
</div>
</div>
<div id="d51ff216" class="cell code" id="d51ff216">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>np.argmax(pred)</span></code></pre></div>
</div>
<div id="2ff9233c" class="cell code" id="2ff9233c"
data-outputId="3bda39ab-1dd4-42d2-c2a1-5a5deccab0d5">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>y_pred</span></code></pre></div>
<div class="output execute_result" data-execution_count="32">
<pre><code>0</code></pre>
</div>
</div>
<div id="fd5364b2" class="cell code" id="fd5364b2">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>index<span class="op">=</span>[<span class="st">&#39;left Bundle Branch block&#39;</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Normal&#39;</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Premature Atrial Contraction&#39;</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Premature Ventricular Contraction&#39;</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Right Bundle Branch Block&#39;</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Ventricular Fibrillation&#39;</span>]</span></code></pre></div>
</div>
<div id="07751543" class="cell code" id="&quot;07751543&quot;">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="bu">str</span>(index[y_pred])</span></code></pre></div>
</div>
<div id="b6c10d2e" class="cell code" id="b6c10d2e"
data-outputId="95582919-8c4e-472f-c9a8-ce4c1f511884">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<div class="output execute_result" data-execution_count="35">
<pre><code>&#39;left Bundle Branch block&#39;</code></pre>
</div>
</div>
<div id="e17537bc" class="cell code" id="e17537bc"
data-outputId="ee452ece-cf26-4381-a6fd-0e32bbe7ef2b">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;------------------------------------------------------&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>------------------------------------------------------
</code></pre>
</div>
</div>
<div id="808d1e78" class="cell code" id="808d1e78"
data-outputId="d7e43671-29de-471f-a716-f4de177cffb0">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model building</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convolutional layers</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>model.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>model.add(Dropout(<span class="fl">0.25</span>))  <span class="co"># Dropout regularization</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>model.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>model.add(Dropout(<span class="fl">0.25</span>))  <span class="co"># Dropout regularization</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>model.add(Flatten())  <span class="co"># Input for dense layers</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Dense layers</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>model.add(Dropout(<span class="fl">0.5</span>))  <span class="co"># Dropout regularization</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>model.add(Dropout(<span class="fl">0.5</span>))  <span class="co"># Dropout regularization</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>model.add(Dropout(<span class="fl">0.5</span>))  <span class="co"># Dropout regularization</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">6</span>, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>))</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Model compilation</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>, loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Model training</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>model.fit_generator(</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    generator<span class="op">=</span>x_train,</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>    steps_per_epoch<span class="op">=</span><span class="bu">len</span>(x_train),</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>x_test,</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    validation_steps<span class="op">=</span><span class="bu">len</span>(x_test)</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the model</span></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>model.save(<span class="st">&#39;ECG_with_regularization.h5&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&quot;Epoch 1/10
480/480 [==============================] - 81s 162ms/step - loss: 1.4726 - accuracy: 0.4728 - val_loss: 1.6474 - val_accuracy: 0.3193
Epoch 2/10
480/480 [==============================] - 78s 161ms/step - loss: 1.1455 - accuracy: 0.5784 - val_loss: 0.7733 - val_accuracy: 0.7043
Epoch 3/10
480/480 [==============================] - 77s 160ms/step - loss: 0.5438 - accuracy: 0.8245 - val_loss: 0.5892 - val_accuracy: 0.7890
Epoch 4/10
480/480 [==============================] - 77s 160ms/step - loss: 0.4224 - accuracy: 0.8661 - val_loss: 0.4874 - val_accuracy: 0.8331
Epoch 5/10
480/480 [==============================] - 77s 159ms/step - loss: 0.3642 - accuracy: 0.8846 - val_loss: 0.4401 - val_accuracy: 0.8624
Epoch 6/10
480/480 [==============================] - 77s 160ms/step - loss: 0.3369 - accuracy: 0.8984 - val_loss: 0.4404 - val_accuracy: 0.8510
Epoch 7/10
480/480 [==============================] - 77s 160ms/step - loss: 0.3093 - accuracy: 0.9052 - val_loss: 0.4239 - val_accuracy: 0.8776
Epoch 8/10
480/480 [==============================] - 76s 159ms/step - loss: 0.2872 - accuracy: 0.9097 - val_loss: 0.3758 - val_accuracy: 0.8896
Epoch 9/10
480/480 [==============================] - 77s 160ms/step - loss: 0.2852 - accuracy: 0.9147 - val_loss: 0.3917 - val_accuracy: 0.8985
Epoch 10/10
480/480 [==============================] - 77s 159ms/step - loss: 0.2812 - accuracy: 0.9130 - val_loss: 0.4129 - val_accuracy: 0.8914
</code></pre>
</div>
</div>
<div id="jURgoAp2WMYu" class="cell code" data-execution_count="6"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="jURgoAp2WMYu" data-outputId="8eda79e1-d398-4ce9-f4e1-ad0a63279d95">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> model.predict_generator(test_generator)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_generator.classes</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/1979c3a75b7154c7b2279443c9a548baa04ccbd7.png" /></p>
</div>
</div>
<div id="88ef5fb7" class="cell code" id="88ef5fb7">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Convolution2D, MaxPooling2D, Flatten</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.regularizers <span class="im">import</span> l2  <span class="co"># Import L2 regularization</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span></code></pre></div>
</div>
<div id="2d0808a7" class="cell code" id="2d0808a7"
data-outputId="d9dd8723-f857-4790-f7c8-6dd7725bbcc3">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> Sequential()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convolutional layers with L2 regularization</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>model4.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, kernel_regularizer<span class="op">=</span>l2(<span class="fl">0.01</span>)))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>model4.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>model4.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, kernel_regularizer<span class="op">=</span>l2(<span class="fl">0.01</span>)))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>model4.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>model4.add(Flatten())  <span class="co"># Input for dense layers</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Dense layers with L2 regularization</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>model4.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, kernel_regularizer<span class="op">=</span>l2(<span class="fl">0.01</span>)))</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>model4.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, kernel_regularizer<span class="op">=</span>l2(<span class="fl">0.01</span>)))</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>model4.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, kernel_regularizer<span class="op">=</span>l2(<span class="fl">0.01</span>)))</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>model4.add(Dense(units<span class="op">=</span><span class="dv">6</span>, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>))</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Model compilation</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>model4.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>, loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Model training</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>model4.fit_generator(</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    generator<span class="op">=</span>x_train,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    steps_per_epoch<span class="op">=</span><span class="bu">len</span>(x_train),</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>x_test,</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    validation_steps<span class="op">=</span><span class="bu">len</span>(x_test)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the model</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>model4.save(<span class="st">&#39;ECG_with_L2_regularization.h5&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/10
480/480 [==============================] - 75s 150ms/step - loss: 1.7935 - accuracy: 0.5766 - val_loss: 1.2312 - val_accuracy: 0.6488
Epoch 2/10
480/480 [==============================] - 71s 148ms/step - loss: 0.7631 - accuracy: 0.8385 - val_loss: 0.8670 - val_accuracy: 0.7719
Epoch 3/10
480/480 [==============================] - 72s 149ms/step - loss: 0.5966 - accuracy: 0.8887 - val_loss: 0.7967 - val_accuracy: 0.7946
Epoch 4/10
480/480 [==============================] - 71s 148ms/step - loss: 0.5332 - accuracy: 0.9142 - val_loss: 0.8361 - val_accuracy: 0.8004
Epoch 5/10
480/480 [==============================] - 71s 148ms/step - loss: 0.4999 - accuracy: 0.9224 - val_loss: 0.7909 - val_accuracy: 0.8205
Epoch 6/10
480/480 [==============================] - 72s 150ms/step - loss: 0.4773 - accuracy: 0.9254 - val_loss: 0.6752 - val_accuracy: 0.8401
Epoch 7/10
480/480 [==============================] - 71s 148ms/step - loss: 0.4429 - accuracy: 0.9363 - val_loss: 0.9148 - val_accuracy: 0.8616
Epoch 8/10
480/480 [==============================] - 71s 148ms/step - loss: 0.4359 - accuracy: 0.9381 - val_loss: 0.7123 - val_accuracy: 0.8816
Epoch 9/10
480/480 [==============================] - 71s 148ms/step - loss: 0.4172 - accuracy: 0.9406 - val_loss: 0.6875 - val_accuracy: 0.8940
Epoch 10/10
480/480 [==============================] - 71s 148ms/step - loss: 0.4092 - accuracy: 0.9437 - val_loss: 0.6231 - val_accuracy: 0.9089
</code></pre>
</div>
</div>
<div id="3pzPDD2pVwxB" class="cell code" data-execution_count="5"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="3pzPDD2pVwxB" data-outputId="a93b1b29-7758-4dc0-9897-0b0f5ea72a1a">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> model4.predict_generator(test_generator)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_generator.classes</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/c8921270913d2e1cc365b917e1d6e62b81ad6b2f.png" /></p>
</div>
</div>
<div id="ac5761e8" class="cell code" id="ac5761e8"
data-outputId="e7a80d7e-c23a-40c0-b5ca-7b92427bf54b">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Convolution2D, MaxPooling2D, Flatten</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data augmentation and preprocessing</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    width_shift_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    height_shift_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    shear_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    zoom_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    horizontal_flip<span class="op">=</span><span class="va">True</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>train_generator <span class="op">=</span> train_datagen.flow_from_directory(</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\train&quot;</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    target_size<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    class_mode<span class="op">=</span><span class="st">&quot;categorical&quot;</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>test_generator <span class="op">=</span> test_datagen.flow_from_directory(</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>   <span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\test&quot;</span>,</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    target_size<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>),</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    class_mode<span class="op">=</span><span class="st">&quot;categorical&quot;</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Model building</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>model7 <span class="op">=</span> Sequential()</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Convolutional layers</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>model7.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>model7.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>model7.add(Convolution2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>model7.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>model7.add(Flatten())  <span class="co"># Input for dense layers</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Dense layers</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>model7.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>model7.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>model7.add(Dense(units<span class="op">=</span><span class="dv">6</span>, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>))</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Model compilation</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>model7.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>, loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Model training</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>model7.fit_generator(</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    generator<span class="op">=</span>train_generator,</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    steps_per_epoch<span class="op">=</span><span class="bu">len</span>(train_generator),</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>test_generator,</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    validation_steps<span class="op">=</span><span class="bu">len</span>(test_generator)</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the model</span></span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>model.save(<span class="st">&#39;ECG_with_zoom_and_crop.h5&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Found 15341 images belonging to 6 classes.
Found 6825 images belonging to 6 classes.

Epoch 1/10
480/480 [==============================] - 77s 155ms/step - loss: 1.2718 - accuracy: 0.5492 - val_loss: 1.2231 - val_accuracy: 0.5262
Epoch 2/10
480/480 [==============================] - 74s 155ms/step - loss: 0.7749 - accuracy: 0.7459 - val_loss: 0.9171 - val_accuracy: 0.7015
Epoch 3/10
480/480 [==============================] - 74s 154ms/step - loss: 0.5029 - accuracy: 0.8368 - val_loss: 0.5727 - val_accuracy: 0.8533
Epoch 4/10
480/480 [==============================] - 74s 153ms/step - loss: 0.3504 - accuracy: 0.8863 - val_loss: 0.4560 - val_accuracy: 0.8725
Epoch 5/10
480/480 [==============================] - 74s 155ms/step - loss: 0.2687 - accuracy: 0.9136 - val_loss: 0.4783 - val_accuracy: 0.8805
Epoch 6/10
480/480 [==============================] - 74s 153ms/step - loss: 0.2289 - accuracy: 0.9260 - val_loss: 0.4519 - val_accuracy: 0.9047
Epoch 7/10
480/480 [==============================] - 74s 153ms/step - loss: 0.2084 - accuracy: 0.9329 - val_loss: 0.4741 - val_accuracy: 0.9091
Epoch 8/10
480/480 [==============================] - 74s 154ms/step - loss: 0.1860 - accuracy: 0.9425 - val_loss: 0.5337 - val_accuracy: 0.9120
Epoch 9/10
480/480 [==============================] - 74s 154ms/step - loss: 0.1691 - accuracy: 0.9476 - val_loss: 0.4882 - val_accuracy: 0.9288
Epoch 10/10
480/480 [==============================] - 74s 153ms/step - loss: 0.1616 - accuracy: 0.9507 - val_loss: 0.5340 - val_accuracy: 0.9370
</code></pre>
</div>
</div>
<div id="v7v-FK-bVQYU" class="cell code" data-execution_count="4"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="v7v-FK-bVQYU" data-outputId="a51941a2-c287-4c6b-8043-9d6dcced0be7">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> model7.predict_generator(test_generator)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_generator.classes</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/8374a8781f5a5fa7232d76217e7f801c43fa456a.png" /></p>
</div>
</div>
<div id="e368e938" class="cell code" id="e368e938"
data-outputId="0038bc3f-6b41-4fac-de95-42ab5841fe0d">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> VGG16</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Flatten</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the pre-trained VGG16 model (excluding the top layers)</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> VGG16(weights<span class="op">=</span><span class="st">&#39;imagenet&#39;</span>, include_top<span class="op">=</span><span class="va">False</span>, input_shape<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>, <span class="dv">3</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Freeze the pre-trained layers</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layer <span class="kw">in</span> base_model.layers:</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    layer.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Data augmentation and preprocessing</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    width_shift_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    height_shift_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    shear_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    zoom_range<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    horizontal_flip<span class="op">=</span><span class="va">True</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>train_generator <span class="op">=</span> train_datagen.flow_from_directory(</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\train&quot;</span>,</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    target_size<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>),</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    class_mode<span class="op">=</span><span class="st">&quot;categorical&quot;</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>test_generator <span class="op">=</span> test_datagen.flow_from_directory(</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\test&quot;</span>,</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    target_size<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>),</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>    class_mode<span class="op">=</span><span class="st">&quot;categorical&quot;</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the pre-trained base model to the sequential model</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>model.add(base_model)</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Add custom classification layers on top of the base model</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>model.add(Flatten())</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">6</span>, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>))</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Model compilation</span></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>, loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Model training</span></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>model.fit_generator(</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>    generator<span class="op">=</span>train_generator,</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>    steps_per_epoch<span class="op">=</span><span class="bu">len</span>(train_generator),</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>test_generator,</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>    validation_steps<span class="op">=</span><span class="bu">len</span>(test_generator)</span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the model</span></span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>model.save(<span class="st">&#39;ECG_with_transfer_learning.h5&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Found 15341 images belonging to 6 classes.
Found 6825 images belonging to 6 classes.

Epoch 1/10
480/480 [==============================] - 390s 808ms/step - loss: 0.5639 - accuracy: 0.8119 - val_loss: 0.6659 - val_accuracy: 0.7556
Epoch 2/10
480/480 [==============================] - 390s 813ms/step - loss: 0.2765 - accuracy: 0.9100 - val_loss: 0.5031 - val_accuracy: 0.8356
Epoch 3/10
480/480 [==============================] - 389s 811ms/step - loss: 0.2287 - accuracy: 0.9231 - val_loss: 0.4646 - val_accuracy: 0.8797
Epoch 4/10
480/480 [==============================] - 343s 714ms/step - loss: 0.2016 - accuracy: 0.9325 - val_loss: 0.4379 - val_accuracy: 0.8926
Epoch 5/10
480/480 [==============================] - 233s 485ms/step - loss: 0.1847 - accuracy: 0.9374 - val_loss: 0.5367 - val_accuracy: 0.9028
Epoch 6/10
480/480 [==============================] - 233s 485ms/step- loss: 0.1787 - accuracy: 0.9414 - val_loss: 0.6659 - val_accuracy: 0.9156
Epoch 7/10
480/480 [==============================] - 233s 485ms/step - loss: 0.2765 - accuracy: 0.9569 - val_loss: 0.5031 - val_accuracy: 0.9256
Epoch 8/10
480/480 [==============================] - 233s 485ms/step - loss: 0.2287 - accuracy: 0.9589 - val_loss: 0.4646 - val_accuracy: 0.9397
Epoch 9/10
480/480 [==============================] - 233s 485ms/step - loss: 0.2016 - accuracy: 0.9678 - val_loss: 0.4379 - val_accuracy: 0.9426
Epoch 10/10
480/480 [==============================] - 233s 485ms/step - loss: 0.1847 - accuracy: 0.9788 - val_loss: 0.5367 - val_accuracy: 0.9489
</code></pre>
</div>
</div>
<div id="0ac7db2a" class="cell code" data-execution_count="2"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="0ac7db2a" data-outputId="f6e4afed-540a-49d9-c8ef-ccf538da0689">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> model.predict_generator(test_generator, steps<span class="op">=</span><span class="bu">len</span>(test_generator))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_generator.classes</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/323758596520278de3437ff23cf3fcf1eb348090.png" /></p>
</div>
</div>
<div id="a71565ac" class="cell code" id="a71565ac"
data-outputId="0107f1cc-70d3-4474-c4ef-e00a331220c0">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> load_model</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load individual trained models</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> load_model(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\Dheeraj_Models\Dheeraj_ECG_1.h5&quot;</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> load_model(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\Dheeraj_Models\Dheeraj_ECG_2.h5&quot;</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> load_model(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\Dheeraj_Models\ECG_with_L2_regularization.h5&quot;</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> load_model(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\Dheeraj_Models\ECG_simpler_model.h5&quot;</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>model5 <span class="op">=</span> load_model(<span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\Dheeraj_Models\ECG_with_transfer_learning.h5&quot;</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Data preprocessing for test data</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="fl">1.</span><span class="op">/</span><span class="dv">255</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>test_generator <span class="op">=</span> test_datagen.flow_from_directory(</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r&quot;C:\Users\HP\VITC_Projects\3. Ecg Cnn Arythmia Detection\data\test&quot;</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    target_size<span class="op">=</span>(<span class="dv">64</span>, <span class="dv">64</span>),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    class_mode<span class="op">=</span><span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions using individual models</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>preds_model1 <span class="op">=</span> model1.predict_generator(test_generator)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>preds_model2 <span class="op">=</span> model2.predict_generator(test_generator)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>preds_model3 <span class="op">=</span> model3.predict_generator(test_generator)</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>preds_model4 <span class="op">=</span> model4.predict_generator(test_generator)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>preds_model5 <span class="op">=</span> model5.predict_generator(test_generator)</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all predictions have the same shape</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>preds_model1 <span class="op">=</span> preds_model1[:, :<span class="dv">6</span>]  <span class="co"># Assuming 6 output units for classification</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>preds_model2 <span class="op">=</span> preds_model2[:, :<span class="dv">6</span>]</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>preds_model3 <span class="op">=</span> preds_model3[:, :<span class="dv">6</span>]</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>preds_model4 <span class="op">=</span> preds_model4[:, :<span class="dv">6</span>]</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>preds_model5 <span class="op">=</span> preds_model5[:, :<span class="dv">6</span>]</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensemble the predictions using a voting classifier</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>ensemble_preds <span class="op">=</span> np.argmax(preds_model1 <span class="op">+</span> preds_model2 <span class="op">+</span> preds_model3 <span class="op">+</span> preds_model4 <span class="op">+</span> preds_model5, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Get true labels</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>true_labels <span class="op">=</span> test_generator.classes</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate accuracy</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(true_labels, ensemble_preds)</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Ensemble Accuracy:&quot;</span>, accuracy)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Found 6825 images belonging to 6 classes.
Ensemble Accuracy: 0.953388278388278
</code></pre>
</div>
</div>
<div id="b85ccaa8" class="cell code" data-execution_count="3"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:406}"
id="b85ccaa8" data-outputId="ba5b410c-49a8-40fd-bc88-764d818bf8ff">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(true_labels, ensemble_preds)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Confusion Matrix:&quot;</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf_matrix)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2138a5f5750f4fcba4fa25808e17f2bd/e66dec6a75d96b512e36d43aa1a2f0f7dc41fedc.png" /></p>
</div>
</div>
<div id="yn8AElTWUTIT" class="cell code" id="yn8AElTWUTIT">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
